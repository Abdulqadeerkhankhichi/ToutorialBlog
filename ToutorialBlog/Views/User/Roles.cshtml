@model IEnumerable<ToutorialBlog.Models.tblRole>
<div class="toolbar mb-n1 pt-3 mb-lg-n3 pt-lg-6" id="kt_toolbar">

</div>
<!--end::Toolbar-->
<!--begin::Container-->
<div id="kt_content_container" class="d-flex flex-column-fluid align-items-start container-xxl">
    <!--begin::Post-->
    <div class="content flex-row-fluid" id="kt_content">
        @if (ViewBag.Createmessage != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert" id="LinkCopy">
                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="me-2"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>

                @ViewBag.Createmessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        @if (ViewBag.Deletemessage != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert" id="LinkCopy">
                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="me-2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>

                @ViewBag.Deletemessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        @if (ViewBag.updatemessage != null)
        {
            <div class="alert alert-warning alert-dismissible fade show" role="alert" id="LinkCopy">
                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="me-2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                @ViewBag.updatemessage
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        @if (ViewBag.Error != null)
        {
            <div class="alert alert-warning alert-dismissible fade show" role="alert" id="LinkCopy">
                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="me-2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                @ViewBag.Error
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        <!--begin::Row-->
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-5 g-xl-9">
            <!--begin::Col-->
            @foreach (var item in Model)
            {


                <div class="col-md-4">
                    <!--begin::Card-->
                    <div class="card card-flush">
                        <!--begin::Card header-->
                        <div class="card-header">
                            <!--begin::Card title-->
                            <div class="card-title">

                                <h2 id="ListRole">@item.Role</h2>
                            </div>
                            <!--end::Card title-->
                        </div>
                        <!--end::Card header-->
                        <!--begin::Card body-->
                        <div class="card-body pt-1">
                            <!--begin::Users-->
                            @if (item.RoleId == 1)
                            {
                                <div class="fw-bolder text-gray-600 mb-5">Total users with this role: @ViewBag.AdminCount</div>
                            }
                            else
                            {
                                <div class="fw-bolder text-gray-600 mb-5">Total users with this role: @ViewBag.UserCount</div>
                            }

                            <!--end::Users-->
                            <!--begin::Permissions-->
                            @*<div class="d-flex flex-column text-gray-600">
                                    <div class="d-flex align-items-center py-2">
                                        <span class="bullet bg-primary me-3"></span>All Admin Controls
                                    </div>
                                    <div class="d-flex align-items-center py-2">
                                        <span class="bullet bg-primary me-3"></span>View and Edit Financial Summaries
                                    </div>
                                    <div class="d-flex align-items-center py-2">
                                        <span class="bullet bg-primary me-3"></span>Enabled Bulk Reports
                                    </div>
                                    <div class="d-flex align-items-center py-2">
                                        <span class="bullet bg-primary me-3"></span>View and Edit Payouts
                                    </div>
                                    <div class="d-flex align-items-center py-2">
                                        <span class="bullet bg-primary me-3"></span>View and Edit Disputes
                                    </div>
                                    <div class='d-flex align-items-center py-2'>
                                        <span class='bullet bg-primary me-3'></span>
                                        <em>and 7 more...</em>
                                    </div>
                                </div>*@
                            <!--end::Permissions-->
                            <h2 hidden id="ListRoleId">@item.RoleId</h2>
                            <h2 hidden id="GListRole">@item.Role</h2>
                            <button type="button" class="btn btn-light btn-active-light-primary my-1" data-bs-toggle="modal" data-bs-target="#kt_modal_add_role" id="EditRole">Edit Role</button>

                        </div>
                        <!--end::Card body-->
                        <!--begin::Card footer-->
                        @*<div class="card-footer flex-wrap pt-0">
                            </div>*@
                        <!--end::Card footer-->
                    </div>
                    <!--end::Card-->
                </div>
            }
            <!--end::Col-->
            <!--begin::Add new card-->
            <div class="ol-md-4">
                <!--begin::Card-->
                <div class="card ">
                    <!--begin::Card body-->
                    <div class="card-body d-flex flex-center">
                        <!--begin::Button-->
                        <button type="button" class="btn btn-clear d-flex flex-column flex-center" data-bs-toggle="modal" id="AddRole" data-bs-target="#kt_modal_add_role">
                            <!--begin::Illustration-->
                            <!--end::Illustration-->
                            <!--begin::Label-->
                            <div class="fw-bolder fs-3 text-gray-600 text-hover-primary">Add New Role</div>
                            <!--end::Label-->
                        </button>
                        <!--begin::Button-->
                    </div>
                    <!--begin::Card body-->
                </div>
                <!--begin::Card-->
            </div>
            <!--begin::Add new card-->
        </div>
        <!--end::Row-->
        <!--begin::Modals-->
        <!--begin::Modal - Add role-->
        <div class="modal fade" id="kt_modal_add_role" tabindex="-1" aria-hidden="true">
            <!--begin::Modal dialog-->
            <div class="modal-dialog modal-dialog-centered mw-750px">
                <!--begin::Modal content-->
                <div class="modal-content">
                    <!--begin::Modal header-->
                    <div class="modal-header">
                        <!--begin::Modal title-->
                        <h2 class="fw-bolder">Add a Role</h2>
                        <!--end::Modal title-->
                        <!--begin::Close-->
                        <div class="btn btn-icon btn-sm btn-active-icon-primary" data-kt-roles-modal-action="close">
                            <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                            <span class="svg-icon svg-icon-1" id="RoleModalClose">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="black" />
                                    <rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="black" />
                                </svg>
                            </span>
                            <!--end::Svg Icon-->
                        </div>
                        <!--end::Close-->
                    </div>
                    <!--end::Modal header-->
                    <!--begin::Modal body-->
                    <div class="modal-body scroll-y mx-lg-5 my-7">
                        <!--begin::Form-->
                        <form id="kt_modal_add_role_form" class="form" action="#">
                            <!--begin::Scroll-->
                            <div class="d-flex flex-column scroll-y me-n7 pe-7" id="kt_modal_add_role_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_add_role_header" data-kt-scroll-wrappers="#kt_modal_add_role_scroll" data-kt-scroll-offset="300px">
                                <!--begin::Input group-->
                                <div class="fv-row mb-10">
                                    <!--begin::Label-->
                                    <label class="fs-5 fw-bolder form-label mb-2">
                                        <span class="required">Role name</span>
                                    </label>
                                    <!--end::Label-->
                                    <!--begin::Input-->
                                    <input type="text" hidden name="MARoleID" id="MARoleID" value="" />
                                    <div class="alert alert-warning alert-dismissible fade show" role="alert" id="RoleNameError" style="display:none;">
                                        <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="me-2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                                        Role name required!!!
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                    <input class="form-control form-control-solid" id="modalRoleName" placeholder="Enter a role name" name="role_name" required />
                                    <!--end::Input-->
                                </div>
                                <!--end::Input group-->
                                <!--begin::Permissions-->
                                <div class="fv-row">
                                    <!--begin::Label-->
                                    <label class="fs-5 fw-bolder form-label mb-2">Role Permissions</label>
                                    <!--end::Label-->
                                    <!--begin::Table wrapper-->
                                    <div class="table-responsive">
                                        <!--begin::Table-->
                                        <table class="table align-middle table-row-dashed fs-6 gy-5" id="MenuAccessTbl">
                                            <!--begin::Table body-->
                                            <tbody class="text-gray-600 fw-bold">
                                                @foreach (var item in @ViewBag.SelectedMenuAccess)
                                                {
                                                    <tr>
                                                        <!--begin::Label-->

                                                        <td class="text-gray-800" id="AMenuId">@item.MenuId</td>
                                                        <td class="text-gray-800" id="AMenuName">@item.Menu.Name</td>
                                                        <!--end::Label-->
                                                        <!--begin::Options-->
                                                        <td>
                                                            <!--begin::Wrapper-->
                                                            <div class="d-flex">
                                                                <!--begin::Checkbox-->
                                                                <label class="form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5">
                                                                    @if (item.isActive == true)
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" id="userManagementRead" value="" name="user_management_active" checked />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" id="userManagementRead" value="" name="user_management_active" />
                                                                    }

                                                                    <span class="form-check-label">Active</span>
                                                                </label>
                                                                <!--end::Checkbox-->
                                                                <!--begin::Checkbox-->
                                                                <label class="form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5">
                                                                    @if (item.CreateAccess == true)
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadCreate" name="userManagementReadCreate" checked />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadCreate" name="userManagementReadCreate" />
                                                                    }

                                                                    <span class="form-check-label">Create</span>
                                                                </label>
                                                                <!--end::Checkbox-->
                                                                <!--begin::Checkbox-->
                                                                <label class="form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5">
                                                                    @if (item.EditAccess == true)
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadEdit" name="userManagementReadEdit" checked />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadEdit" name="userManagementReadEdit" />
                                                                    }

                                                                    <span class="form-check-label">Edit</span>
                                                                </label>
                                                                <!--end::Checkbox-->
                                                                <!--begin::Checkbox-->
                                                                <label class="form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5">
                                                                    @if (item.DeleteAccess == true)
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadDelete" name="userManagementReadDelete" checked />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadDelete" name="userManagementReadDelete" />
                                                                    }

                                                                    <span class="form-check-label">Delete</span>
                                                                </label>
                                                                <!--end::Checkbox-->
                                                                <!--begin::Checkbox-->
                                                                <label class="form-check form-check-sm form-check-custom form-check-solid">
                                                                    @if (item.ApproveAccess == true)
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadApprove" name="userManagementReadApprove" checked />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input class="form-check-input" type="checkbox" value="" id="userManagementReadApprove" name="userManagementReadApprove" />
                                                                    }
                                                                    <span class="form-check-label">Approve</span>
                                                                </label>
                                                                <!--end::Checkbox-->
                                                            </div>
                                                            <!--end::Wrapper-->
                                                        </td>
                                                        <!--end::Options-->
                                                    </tr>
                                                }

                                            </tbody>
                                            <!--end::Table body-->
                                        </table>
                                        <!--end::Table-->
                                    </div>
                                    <!--end::Table wrapper-->
                                </div>
                                <!--end::Permissions-->
                            </div>
                            <!--end::Scroll-->
                            <!--begin::Actions-->
                            <div class="text-center pt-15">
                                <button type="reset" class="btn btn-light me-3" data-kt-roles-modal-action="cancel">Discard</button>
                                <button type="submit" class="btn btn-primary" data-kt-roles-modal-action="submit" id="btnSave">
                                    <span class="indicator-label">Submit</span>
                                    <span class="indicator-progress">
                                        Please wait...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                    </span>
                                </button>
                            </div>
                            <!--end::Actions-->
                        </form>
                        <!--end::Form-->
                    </div>
                    <!--end::Modal body-->
                </div>
                <!--end::Modal content-->
            </div>
            <!--end::Modal dialog-->
        </div>

    </div>
    <!--end::Post-->
</div>
<script src="~/assets/plugins/global/plugins.bundle.js"></script>

<script>
    $(document).ready(function () {
        $('.alert-dismissible').fadeOut(10000);
        //$(".nav li a").removeClass("active");
        //$('#Roles').addClass('active');
    });


    $("body").on("click", "#RoleModalClose", function () {
        $('#kt_modal_add_role').modal('hide');
    });

    $("body").on("click", "#AddRole", function () {
        $("#MARoleID").val("");
        $("#modalRoleName").val("");
        $(":checkbox").attr("checked", false);


    });


    $("body").on("click", "#EditRole", function () {
        var row = $(this).closest('div');
        var RoleId = row.find("#ListRoleId").text();
        var Role = row.find("#GListRole").text();
        var model = {
            RoleId: RoleId,
        };
        console.log(model);
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetAccessLevel", "User")",
            data: JSON.stringify(model),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (r) {
                $("#MARoleID").val(RoleId);
                $("#modalRoleName").val(Role);
                var items = '';
                $('#MenuAccessTbl tbody').empty();
                console.log(r);
                $.each(r, function (i, item) {
                        var rows = "<tr>"
                            + "<td class='text-gray-800' id='AMenuId'>" + item.MenuId + "</td>"
                            + "<td class='text-gray-800' id='AMenuName'>" + item.Menu.Name + "</td>"
                            + "<td> <div class='d-flex'>"
                            + "<label class='form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5'>"
                        if (item.isActive == true) {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementRead' value='' name='user_management_active' checked /> <span class='form-check-label'>Active</span> </label>"
                        }
                        else {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementRead' value='' name='user_management_active' /> <span class='form-check-label'>Active</span> </label>"
                        }
                            rows+= "<label class='form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5'>"
                        if (item.CreateAccess == true) {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadCreate' value='' name='userManagementReadCreate' checked /> <span class='form-check-label'>Create</span> </label>"
                        }
                        else {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadCreate' value='' name='userManagementReadCreate' /> <span class='form-check-label'>Create</span> </label>"
                        }
                            rows+= "<label class='form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5'>"
                        if (item.EditAccess == true) {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadEdit' value='' name='userManagementReadEdit' checked /> <span class='form-check-label'>Edit</span> </label>"
                        }
                        else {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadEdit' value='' name='userManagementReadEdit' /> <span class='form-check-label'>Edit</span> </label>"
                        }
                            rows+= "<label class='form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5'>"
                        if (item.DeleteAccess == true) {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadDelete' value='' name='userManagementReadDelete' checked /> <span class='form-check-label'>Delete</span> </label>"
                        }
                        else {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadDelete' value='' name='userManagementReadDelete' /> <span class='form-check-label'>Delete</span> </label>"
                        }
                            rows+= "<label class='form-check form-check-sm form-check-custom form-check-solid me-5 me-lg-5'>"
                        if (item.ApproveAccess == true) {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadApprove' value='' name='userManagementReadApprove' checked /> <span class='form-check-label'>Approve</span> </label>"
                        }
                        else {
                            rows += "<input class='form-check-input' type='checkbox' id='userManagementReadApprove' value='' name='userManagementReadApprove' /> <span class='form-check-label'>Approve</span> </label>"
                        }

                        rows+= " </div></td></tr>";
                    $('#MenuAccessTbl tbody').append(rows);

                });
            },
            failure: function (errMsg) {
                location.reload();
            }
        });

    });


     $("body").on("click", "#btnSave", function () {

         if ($("#modalRoleName").val() == "") {

             $("#RoleNameError").show();
         }
         else {
             $("#LblError").fadeOut();
             $("#btnSave").attr("disabled", true);
             $("#loading").show();



             var Items = new Array();
             var RoleID = $("#MARoleID").val();

             var Heads = new Array();
             var Head = {};
             Head.RoleId = RoleID;
             Head.Role = $("#modalRoleName").val();
             Heads.push(Head);
             console.log(Heads);



             $("#MenuAccessTbl TBODY TR").each(function () {
                 var row = $(this);
                 var Item = {};

                 Item.RoleId = RoleID;
                 Item.MenuId = row.find("#AMenuId").text();
                 Item.isActive = row.find("#userManagementRead").prop("checked");
                 Item.CreateAccess = row.find("#userManagementReadCreate").prop("checked");
                 Item.EditAccess = row.find("#userManagementReadEdit").prop("checked");
                 Item.DeleteAccess = row.find("#userManagementReadDelete").prop("checked");
                 Item.ApproveAccess = row.find("#userManagementReadApprove").prop("checked");
                 Items.push(Item);
             });
             console.log(Items);


             var model = {
                 HeadData: Heads,
                 TailData: Items,
             };
             console.log(model);

             //Send the JSON array to Controller using AJAX.

             $.ajax({
                 type: "POST",
                 url: "/User/CreateRole",
                 data: JSON.stringify(model),
                 contentType: "application/json; charset=utf-8",
                 dataType: "json",
                 success: function (r) {
                     //alert(r + " record(s) inserted.");
                     var url = window.location.origin;
                     if (RoleID == 0) {
                         url += '/User/Roles?Createmessage=Role has been Create successfully.';
                     }
                     else {
                         url += '/User/Roles?updatemessage=Role has been update successfully.';
                     }

                     window.location.href = url;
                 },
                 failure: function (errMsg) {
                     location.reload();
                 }
             });
         }





    });
</script>